# KRC Global Map 🌍

KRC Global의 ODA 사업 및 기술컨설팅 프로젝트를 세계 지도에 시각화하는 인터랙티브 웹 애플리케이션입니다.

## 🚀 주요 기능

### 📍 지도 시각화
- **Leaflet 기반** 인터랙티브 세계 지도
- **프로젝트별 마커** 표시 (국가별 국기 아이콘)
- **카테고리별 색상 구분** (기술컨설팅: 파랑, ODA: 주황)
- **실시간 검색** (주소/사업명 통합 검색)
- **국기 클릭 시 포커스**: 국기를 클릭하면 지도가 해당 국가 경계가 보이도록 자동 이동/확대
- **국기 배지 카운트**: 국기 좌우에 기술컨설팅/ODA 개수를 원문자로 표시(현재 필터 반영)

### 📊 프로젝트 히스토리 패널
- **🍷 Compact 와인 타임라인**: 단일 와인색 선 + 굵은 연도 점/라벨
- **간트형 레인 배치**: 프로젝트 뱃지가 겹치지 않도록 자동 레인 배정
- **📋 상세 프로젝트 목록**: 스크롤 가능한 풍부한 정보
- **🎯 상태별 표시**: 제안중/시행중/완료 구분
- **💰 예산 정보**: 카테고리별 총 예산 표시
- **🏢 발주처 정보**: 주요 발주처 및 프로젝트 수
- **⏭️ 좌우 스크롤**: 긴 타임라인을 수평 스크롤로 탐색

### 🎨 사용자 인터페이스
- **반응형 디자인**: 데스크톱/모바일 최적화
- **통합 필터바**: 검색과 카테고리 필터를 한 줄에 배치
- **카테고리 필터**: 기술컨설팅/ODA 개별 필터링 (기본 둘 다 활성화)
- **편집 기능(비활성화됨)**: 현재 배포에서는 편집 UI가 비활성화되어 있습니다

## 🛠️ 기술 스택

- **Frontend**: HTML5, CSS3, JavaScript (ES6+)
- **지도 라이브러리**: Leaflet.js
- **데이터 소스**: JSON 파일 (Excel → JSON 변환)
- **서버**: Node.js (개발용) / Python HTTP 서버
- **의존성**: 없음 (순수 웹 기술, CDN 사용)

## 📦 설치 및 실행

### 방법 1: Node.js 사용 (권장)
```bash
npm install
npm start                    # 기본 포트 8000
PORT=8080 npm start         # 포트 변경
```

### 방법 2: Python 사용
```bash
PORT=8000 bash scripts/serve.sh
```

접속: http://localhost:8000

## 📁 프로젝트 구조

```
KRCglobal/
├── index.html                     # 메인 애플리케이션 (단일 파일)
├── data/
│   ├── global_oda.json            # ODA 프로젝트 데이터
│   ├── global_consulting.json     # 컨설팅 프로젝트 데이터
│   └── *.xlsx                     # 원본 Excel 파일들
├── scripts/
│   ├── convert_xlsx_to_json.py    # Excel → JSON 변환
│   ├── dev-server.js              # Node.js 개발 서버
│   └── serve.sh                   # Python 서버 스크립트
├── archive/                       # 이전 버전 아카이브
├── icon-*.png                     # PWA 아이콘들
├── manifest.json                  # PWA 매니페스트
├── package.json                   # Node.js 프로젝트 설정
├── CLAUDE.md                      # 개발자 가이드
└── README.md                      # 프로젝트 문서
```

## 🔄 데이터 업데이트

1. **Excel 파일 준비**: `data/` 폴더에 최신 Excel 파일 배치
2. **JSON 변환 실행**:
   ```bash
   python3 scripts/convert_xlsx_to_json.py
   ```
3. **브라우저 새로고침**: 변경사항 자동 반영

## 🎯 사용법

### 기본 탐색
- **지도 확대/축소**: 마우스 휠 또는 +/- 버튼
- **마커 클릭**: 프로젝트 상세 정보 팝업
- **국기 클릭**: 국가별 프로젝트 히스토리 모달 (와인색 타임라인 포함)

### 필터링 및 검색
- **통합 필터바**: 검색과 카테고리 필터가 한 줄에 배치
- **카테고리 필터**: 상단 버튼으로 기술컨설팅/ODA 개별 토글
- **검색**: 주소 또는 사업명으로 실시간 검색
- **기본 설정**: 두 카테고리 모두 기본 활성화

### 편집 모드 (현재 비활성화)
- 운영 중인 빌드에서는 편집 UI/드래그/내보내기/불러오기가 비활성화되어 있습니다.
- 개발/관리 목적으로만 필요 시 코드에서 `toggleEditMode()`/관련 버튼 표시를 복구할 수 있습니다.

## 📱 모바일 지원

- **반응형 레이아웃**: 화면 크기에 따른 자동 조정
- **터치 제스처**: 핀치 줌, 터치 드래그 지원
- **하단 패널**: 모바일에서 우측 패널이 하단으로 이동 (화면의 33% 차지)
- **최적화된 국기 레이아웃**: 모바일에서 4개국씩 한 줄로 표시
- **지도 중심점 자동 조정**: 패널을 고려한 지도 위치 최적화
- **무한 스크롤 제한**: 지도 경계 설정으로 사용성 향상

## 🆕 최신 업데이트 (v1.8)

### 2025-09-18 추가사항
- 국기 클릭 시 해당 국가로 지도 자동 포커스(경계가 보이도록 fitBounds)
- 국기 버튼 좌/우 배지에 기술컨설팅/ODA 개수 표시(필터 반영, 모바일 대응 크기)
- ODA 토글 시 국가 누락되지 않도록 발주처 필터 상태 자동 정리(동시 활성 시 클라이언트 필터 비움)
- 편집 기능 기본 비활성화(운영 안정성 우선)

### 2025-09-17 추가사항
- 타임라인: 현재시점 점선 + [현재] 칩 라벨(YYYY.MM), 빈 해 압축(간격 제거), 미래 연도 라벨/점 이동
- 모바일: 핀치 제스처로 확대/축소(0.5x~3x), 확대 후에도 현재시점 자동 노출
- 발주처 필터(기술컨설팅 단일 선택 시): ‘전체’ 토글(전체 선택/해제), WB/IDA 통합(WB), ‘정부’/브루나이 → ‘각국정부’ 정규화, 국가 그리드도 필터 반영

### 🍷 동적 타임라인 시스템 (Dynamic Timeline)
- **지능형 레인 할당**: 최대 동시 진행 프로젝트 수에 따른 동적 레인 배정
- **완전한 정보 표시**: 프로젝트명, 연도, 예산, 발주처, 상태를 모두 표시
- **깔끔한 디자인**: 순백색 배경, 카테고리별 테두리 색상 구분
- **향상된 가독성**: 연도 그리드와 첫 번째 레인 간 적절한 간격
- **데이터 일관성**: 모든 프로젝트가 정확히 표시되도록 검증 강화

### Compact + Gantt 와인 타임라인 (이전 v1.6)
- 단일 라인 + 굵은 와인색 점/라벨로 컴팩트한 연대기
- 간트형 레인 배치로 뱃지 겹침 방지(고밀도 국가 대응)
- 연도 축은 해당 국가의 실제 시작~종료 범위와 정확히 일치

### UI/UX 개선
- **통합 인터페이스**: 검색과 필터를 한 줄로 통합
- **독립 편집 버튼**: 우상단 고정 위치로 접근성 향상
- **모바일 최적화**: 패널 높이 33%로 조정, 4개국 국기 배치
- **국가명 전체 표시**: 긴 국가명도 줄바꿈으로 완전 표시

### 성능 최적화
- **지도 중심점 자동 조정**: 패널 위치를 고려한 최적 뷰포트
- **무한 스크롤 방지**: 지도 경계 설정으로 사용성 개선
- **팝업 색상 구분**: 카테고리별 테두리 색상 동적 적용

## 🔧 개발자 정보

### 코딩 원칙
- **단일 파일 구조**: `KRC/index.html`에 모든 코드 포함
- **외부 의존성 최소화**: CDN 사용, 빌드 과정 불필요
- **브라우저 호환성**: 모던 브라우저 지원 (ES6+)

### 스타일 가이드
- **색상 체계**: 상아색 배경 (#FFF8E7), 진한 파랑 테두리 (#0A3D62)
- **카테고리 색상**: 컨설팅 (#0A3D62), ODA (#E65100)

## 📄 라이선스

이 프로젝트는 KRC Global의 내부 프로젝트입니다.

---

**최종 업데이트**: 2025.09.18
**개발**: Claude Code Assistant
**문의**: KRC Global

### 버전 히스토리
- **v1.7** (2025.09.16): 동적 타임라인 시스템, 지능형 레인 할당, 완전한 프로젝트 정보 표시
- **v1.6** (2025.09.16): Compact+Gantt 와인 타임라인, 날짜 파싱 강화, 로딩 워치독
- **v1.5** (2025.09.16): 와인색 타임라인 시스템, UI/UX 개선, 모바일 최적화
- **v1.4** (2025.09.15): 검색 필터 통합, 편집 버튼 독립화
- **v1.3** (2025.09.14): 팝업 색상 구분, 지도 경계 설정
- **v1.2** (2025.09.13): 모바일 패널 최적화, 국기 레이아웃 개선
- **v1.1** (2025.09.12): 카테고리 필터 개선, 국가명 표시 최적화
- **v1.0** (2025.09.11): 초기 릴리즈
